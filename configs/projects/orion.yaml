# Project Configuration for DreamWorks' Orion and the Dark
# Created: 2025-11-15

project:
  name: "orion"
  full_title: "Orion and the Dark"
  studio: "DreamWorks"
  year: 2024
  runtime: 90
  style: "3d_animation"
  resolution: "1080p"
  genre: "anxiety_adventure"

# Base paths
paths:
  base_dir: "/mnt/data/ai_data/datasets/3d-anime/orion"
  frames: "${base_dir}/frames"
  instances: "${base_dir}/instances_sampled"
  instances_inpainted: "${base_dir}/instances_inpainted"
  clustered: "${base_dir}/clustered"
  clustered_refined: "${base_dir}/clustered_refined"
  pose_subclusters: "${base_dir}/pose_subclusters"
  training_data: "/mnt/data/ai_data/training_data/3d_characters/orion"

# Main characters
characters:
  main:
    - "orion_mendelson"
    - "dark"
  supporting:
    - "light"
    - "sleep"
    - "sweet_dreams"
    - "unexplained_noises"
    - "insomnia"
    - "quiet"
    - "sally"

# Frame extraction settings (hybrid mode for comprehensive coverage)
frame_extraction:
  mode: "hybrid"
  scene_threshold: 30.0  # 3D animation optimized
  frames_per_scene: 10
  min_scene_length: 15
  interval_seconds: 2.0  # Hybrid fallback
  quality: "high"
  jpeg_quality: 95

# Instance segmentation (SAM2) - Using tested settings
segmentation:
  model: "sam2_hiera_large"
  min_mask_size: 16384
  max_instances: 15
  points_per_side: 20  # Balanced mode
  device: "cuda"

# Inpainting settings
inpainting:
  enabled: true
  default_method: "lama"
  occlusion_threshold: 0.15
  auto_detect_character: true

# Identity clustering
clustering:
  method: "hdbscan"
  min_cluster_size: 12
  min_samples: 2
  use_face_detection: true
  similarity_threshold: 0.70

# Pose subclustering
pose_subclustering:
  enabled: false  # Enable after initial clustering
  min_cluster_size: 5
  method: "umap_hdbscan"

# Caption generation
captioning:
  model: "qwen2_vl"
  prefix: "a 3d animated character from dreamworks' orion and the dark, smooth shading, modern new york setting"
  style_tags:
    - "dreamworks orion and the dark style"
    - "3d animation"
    - "anxiety and fear themes"
    - "night and dream sequences"
    - "expressive character animation"
  length_range: [40, 77]

# LoRA training
lora_training:
  base_model: "runwayml/stable-diffusion-v1-5"
  target_size: 400
  network_dim: 32
  network_alpha: 16
  learning_rate: 1e-4
  epochs: 10
  batch_size: 4
  disable_color_jitter: true  # Preserve night/day color contrasts
  disable_horizontal_flip: true  # Preserve character asymmetries

# Quality thresholds (3D animation defaults)
quality:
  alpha_threshold: 0.15
  blur_threshold: 80
  min_face_size: 64
  min_sharpness: 30

# Processing parameters
processing:
  device: "cuda"
  gpu_id: 0
  batch_size: 8
  num_workers: 4
  cache_clear_interval: 10

# Output settings
output:
  save_metadata: true
  save_visualization: false
  save_face_crops: true
  create_thumbnails: true
  compression_quality: 95

# Notes
notes:
  description: "Orion and the Dark is a DreamWorks film about an anxious 11-year-old boy who confronts his fears during a surreal night journey with the entity Dark"
  special_considerations:
    - "Protagonist Orion Mendelson: pale skin, brown messy hair, collared shirt, blue jeans"
    - "Strong contrast between bright day scenes and dark night sequences"
    - "Modern New York setting (Queens neighborhood, school, planetarium)"
    - "Surreal dreamscape and night spirit environments"
    - "Character displays wide range of anxiety-related expressions and postures"
    - "Frequent scenes with Orion hunched, clutching objects, wide-eyed"
    - "Dark entity is large, shadowy figure with expressive features"
    - "Film uses high-contrast lighting to emphasize fear and wonder"

# Pipeline stages
pipeline_stages:
  - name: "frame_extraction"
    enabled: true
  - name: "instance_segmentation"
    enabled: true
  - name: "inpainting"
    enabled: true
  - name: "identity_clustering"
    enabled: true
  - name: "interactive_review"
    enabled: true
  - name: "pose_subclustering"
    enabled: false
  - name: "caption_generation"
    enabled: true
  - name: "lora_training"
    enabled: true

# Processing history (for reference)
processing_history:
  - date: "2025-11-15"
    stage: "frame_extraction"
    status: "pending"
    notes: "Configured for batch processing with hybrid mode"
